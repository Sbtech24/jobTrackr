# 1️⃣ Use official Bun image
FROM oven/bun:1.1.20-alpine AS builder

# 2️⃣ Set working directory
WORKDIR /app

# 3️⃣ Copy package and lock files first (for caching)
COPY bun.lockb package.json ./

# 4️⃣ Install dependencies
RUN bun install --frozen-lockfile

# 5️⃣ Copy source code
COPY . .

# 6️⃣ Build the project (if TypeScript)
RUN bun run build

# 7️⃣ Use a smaller final image
FROM oven/bun:1.1.20-alpine AS production

WORKDIR /app

COPY --from=builder /app /app

EXPOSE 5000

# 8️⃣ Start the app
CMD ["bun", "run", "start"]
